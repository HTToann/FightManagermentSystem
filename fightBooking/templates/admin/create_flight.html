{% extends 'admin/master.html' %} {% block body %}
<div class="container mt-4">
  <h2 class="mb-4">‚úàÔ∏è T·∫°o chuy·∫øn bay m·ªõi</h2>

  <form method="POST">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="start_airport" class="form-label">S√¢n bay ƒëi:</label>
        <select
          id="start_airport"
          name="start_airport"
          class="form-select"
          required
        >
          <option value="">-- Ch·ªçn s√¢n bay --</option>
          {% for airport in airports %}
          <option value="{{ airport.id }}">
            {{ airport.name }} - {{ airport.location }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-6 mb-3">
        <label for="end_airport" class="form-label">S√¢n bay ƒë·∫øn:</label>
        <select
          id="end_airport"
          name="end_airport"
          class="form-select"
          required
        >
          <option value="">-- Ch·ªçn s√¢n bay --</option>
          {% for airport in airports %}
          <option value="{{ airport.id }}">
            {{ airport.name }} - {{ airport.location }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-6 mb-3">
        <label for="start_time" class="form-label">Th·ªùi gian ƒëi:</label>
        <input
          type="datetime-local"
          id="start_time"
          name="start_time"
          class="form-control"
          required
        />
      </div>

      <div class="col-md-6 mb-3">
        <label for="end_time" class="form-label">Th·ªùi gian ƒë·∫øn:</label>
        <input
          type="datetime-local"
          id="end_time"
          name="end_time"
          class="form-control"
          required
        />
      </div>

      <div class="col-md-6 mb-3">
        <label for="plane" class="form-label">M√°y bay:</label>
        <select id="plane" name="plane_id" class="form-select" required>
          <option value="">-- Ch·ªçn m√°y bay --</option>
          {% for plane in planes %}
          <option value="{{ plane.id }}">{{ plane.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <hr />
    <h5 class="mt-4">üõ´ S√¢n bay trung gian (tu·ª≥ ch·ªçn)</h5>
    <div id="layovers-container">
      <!-- C√°c ch·∫∑ng trung gian s·∫Ω th√™m ·ªü ƒë√¢y -->
    </div>

    <button type="button" class="btn btn-secondary my-2" onclick="addLayover()">
      + Th√™m s√¢n bay trung gian
    </button>

    <div class="text-end mt-4">
      <button type="submit" class="btn btn-primary">T·∫°o chuy·∫øn bay</button>
    </div>
  </form>
</div>

<script>
  let layoverCount = 0;
  const maxLayovers = 2; // D·ªÖ d√†ng ƒëi·ªÅu ch·ªânh n·∫øu mu·ªën thay ƒë·ªïi gi·ªõi h·∫°n

  function addLayover() {
    if (layoverCount >= maxLayovers) {
      alert(`‚ùå Ch·ªâ ƒë∆∞·ª£c ph√©p th√™m t·ªëi ƒëa ${maxLayovers} s√¢n bay trung gian!`);
      return;
    }

    layoverCount++;
    const container = document.getElementById("layovers-container");
    const layoverHTML = `
          <div class="row g-3 mb-2 layover-group" data-index="${layoverCount}">
            <div class="col-md-5">
              <label class="form-label">S√¢n bay trung gian ${layoverCount}:</label>
              <select name="layovers[${layoverCount}][airport_id]" class="form-select" required>
                <option value="">-- Ch·ªçn s√¢n bay --</option>
                {% for airport in airports %}
                <option value="{{ airport.id }}">{{ airport.name }} - {{ airport.location }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Gi·ªù ƒë·∫øn:</label>
              <input type="datetime-local" name="layovers[${layoverCount}][arrival]" class="form-control" required />
            </div>
            <div class="col-md-3">
              <label class="form-label">Gi·ªù ƒëi:</label>
              <input type="datetime-local" name="layovers[${layoverCount}][departure]" class="form-control" required />
            </div>
            <div class="col-md-1 d-flex align-items-end">
              <button type="button" class="btn btn-danger btn-sm" onclick="removeLayover(this)">‚úñ</button>
            </div>
          </div>
        `;
    container.insertAdjacentHTML("beforeend", layoverHTML);
  }

  function removeLayover(button) {
    const layoverElement = button.closest(".layover-group");
    if (layoverElement) {
      layoverElement.remove();
      layoverCount--;
    }
  }
</script>
{%endblock%}
